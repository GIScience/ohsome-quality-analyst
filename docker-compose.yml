version: "3"
networks:
  oqt-network:
  oqt-website-network:

services:
  oqt-workers:
    container_name: oqt-workers
    build:
      context: ./
      dockerfile: Dockerfile
    environment:
      OHSOME_API: 'https://api.ohsome.org/v1/'
      POSTGRES_PASSWORD: '${POSTGRES_PASSWORD}'
      POSTGRES_USER: 'hexadmin'
      POSTGRES_DB: 'hexadmin'
      POSTGRES_PORT: "${POSTGRES_PORT}"
      POSTGRES_HOST: "${POSTGRES_HOST}"
      POSTGRES_SCHEMA: "${POSTGRES_SCHEMA}"
    command: uvicorn ohsome_quality_tool.app.main:app --host 0.0.0.0 --port 8000 --reload
    restart: "no"
    ports:
      - "8080:8000"
    volumes:
      - oqt-website:/root/.local/share/ohsome_quality_tool/data
    networks:
      - oqt-network
      - oqt-website-network

  oqt-database:
    container_name: oqt-database
    build:
      context: database/
      dockerfile: Dockerfile.development
    environment:
      POSTGRES_PASSWORD: '${POSTGRES_PASSWORD}'
      POSTGRES_USER: 'hexadmin'
      POSTGRES_DB: 'hexadmin'
    restart: "always"
    ports:
      - "5435:5432"
    volumes:
      - oqt-data:/var/lib/postgresql/data
    networks:
      - oqt-network

  oqt-website:
    container_name: oqt-website
    build:
      context: website/
    ports:
      - "80:80"
    volumes:
      - ./website/website:/usr/share/nginx/html
      - oqt-website:/usr/share/nginx/html/data
      - ./website/website:/usr/share/nginx/html
    networks:
      - oqt-website-network

volumes:
  oqt-data: {}
  oqt-website: {}
